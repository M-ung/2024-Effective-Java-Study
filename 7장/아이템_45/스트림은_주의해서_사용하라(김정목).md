# 스트림은 주의해서 사용하라
스트림이란?
> `Java 8` 부터 다량의 데이터 처리 작업(순차/병렬)을 돕고자 나온 API이며, 두 가지 핵심적인 추상 개념을 제공한다. <br>
스트림은 원하는 결과를 생성하기 위해 파이프라인으로 연결될 수 있는 다양한 메서드를 지원하는 개체 시퀀스이다.  <br>
데이터의 흐름, 즉 스트림이 흘러가는 과정에서 데이터가 순차적으로 하나씩 사용되고 사라진다. <br>
대용량 데이터를 처리할 때 효율을 높이기 위해, 오토박싱/언박싱 과정이 필요 없는 `Intstream` 과 같은 기본형 스트림도 제공한다. <br>

## 📌 스트림의 추상 개념
1. 스트림(stream) : 데이터 원소의 유한 혹은 무한 시퀀스
2. 스트림 파이프라인(stream pipeline) : 이 원소들로 수행하는 연산 단계를 표현

## 📌 스트림 파이프라인 
1️⃣ 중간 연산 <br>
각 중간 연산은 스트림을 어떠한 방식으로 변환하는 역할을 수행하며, 모두 한 스트림을 다른 스트림으로 변환하게 하여 메서드 체이닝을 가능하게 한다. <br>
예를 들어, 각 원소에 함수를 적용하거나 특정 조건을 만족 못하는 원소를 걸러낼 수 있다. <br>
`filter()` , `map()` , `sorted()`

2️⃣ 종단 연산 <br>
종단 연산은 마지막 중간 연산이 내놓은 스트림에 최후의 연산을 가하는 역할을 한다. <br>
예를 들어, 원소를 정렬해 컬렉션에 담거나 특정 원소를 하나 선택하는 식이다. <br>
`forEach()` , `collect()` , `match()` , `count()` , `reduce()`

<br>

예시 코드는 아래와 같다. 
```java
List<Integer> transactionsIds = 
    transactions.stream()
                .filter(t -> t.getType() == Transaction.GROCERY)
                .sorted(comparing(Transaction::getValue).reversed())
                .map(Transaction::getId)
                .collect(toList());
```

## 📌 스트림 파이프라인 특징
1. 지연 평가(lazy evaluation)
지연이란 결과값이 필요할때까지 계산을 늦추는 기법을 의미한다.
> 대용량의 데이터에서, 실제로 필요하지 않은 데이터들을 탐색하는 것을 방지해 속도를 높일 수 있다.  <br>
즉, 종단 연산에 쓰이지 않는 데이터 원소는 계산 자체에 쓰이지 않는다. <br>
그리고 이것을 Short-Circuit 방식이라 부른다. <br>

```
유한 스트림 vs 무한 스트림 
1. 유한 스트림 : 생성할 때 크기가 정해져 있는 스트림 
IntStream ints(long streamsize, int begin, int end) 

2.무한 스트림 : 무한한 크기로 값을 가지는 스트림 
IntStream ints(int begin, int end) 
```

<br>

2. 순차성
기본적으로 스트림 파이프라인은 순차적으로 수행된다. 파이프라인을 병렬로 실행하려면, 파이프라인을 구성하는 스트림 중 하나에서 `parallel` 메서드를 호출해주기만 하면 되나, 효과를 볼 수 있는 상황은 많지 않다.

## 📌 반복문을 스트림으로 무조건 바꾸는것이 좋을까?
1. 모든 반복문을 스트림으로 바꾸기 보다, 반복문과 스트림을 적절히 조합하자.
2.char 값을 처리할 때는 스트림을 사용하지 말자.

## 📌 스트림의 적절한 활용
스트림 파이프라인은 되풀이 되는 계산을 주로 함수 객체(람다/메서드 참조)로 표현하고 반복 코드에는 코드 블록을 사용해 표현한다. <br>
<br>
스트림을 적용하기 좋은 경우 <br>
1. 원소들의 시퀀스를 일관되게 변환해야 하는 경우 : `map()`
2. 원소들의 시퀀스를 필터링 해야 하는 경우 : `filter()`
3. 원소들의 시퀀스를 컬렉션에 모으는 경우(공통된 속성을 기준으로) : `collect()`
4. 원소들의 시퀀스에서 특정 조건을 만족하는 원소를 찾을 경우 : `filter()`

## 📌 스트림으로 처리하기 어려운 경우
> 한 데이터가 파이프라인의 여러 단계를 통과해야할때, 이 데이터의 각 단계에서의 값들에 동시에 접근하는 경우에는 스트림을 사용하기 힘들다. <br>
파이프라인은 일단 한 값을 다른 값에 매핑하고 나면 원래의 값은 잃는 구조이기 때문이다.

## ⭐️ 핵심 정리
```
스트림을 사용해야 멋지게 처리할 수 있는 일이고, 반복 방식이 더 알맞은 일도 있다. 
그리고 수 많은 작업이 둘을 조합했을 때 가장 멋지게 해결된다.
어느 쪽을 선택하는 확고부동한 규칙은 없지만 참고할 만한 지침 정도는 있다.
스트림과 반복 중 어느 쪽이 나은지 확신하기 어렵다면 둘 다 해보고 더 나은 쪽을 택하라.
엥..?
```
